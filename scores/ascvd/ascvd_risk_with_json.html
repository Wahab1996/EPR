
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ASCVD Risk Calculator</title>
  <link rel="stylesheet" href="../../assets/css/style.css" />
  <script src="../../assets/js/theme-toggle.js" defer></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 2em;
      background: var(--bg-color, #f0f0f0);
      color: var(--text-color, #333);
    }
    h1 {
      text-align: center;
      color: #004080;
    }
    form {
      max-width: 600px;
      margin: auto;
    }
    label {
      display: block;
      margin: 1em 0 0.5em;
    }
    input, select {
      width: 100%;
      padding: 0.6em;
      margin-bottom: 1em;
    }
    button {
      background-color: #004080;
      color: white;
      padding: 0.6em 1em;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    .result {
      margin-top: 2em;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>ASCVD Risk Calculator</h1>
  <form id="ascvd-form">
    <label>Age: <input type="number" name="age" required></label>
    <label>Sex:
      <select name="sex" required>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
    </label>
    <label>Race:
      <select name="race" required>
        <option value="white">White</option>
        <option value="black">Black</option>
        <option value="other">Other</option>
      </select>
    </label>
    <label>Total Cholesterol (mg/dL): <input type="number" name="tc" required></label>
    <label>HDL Cholesterol (mg/dL): <input type="number" name="hdl" required></label>
    <label>Systolic BP (mmHg): <input type="number" name="sbp" required></label>
    <label>On Hypertension Treatment?
      <select name="treatment">
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </label>
    <label>Diabetes?
      <select name="diabetes">
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </label>
    <label>Smoker?
      <select name="smoker">
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </label>
    <button type="button" onclick="calculateASCVD()">Calculate</button>
  </form>

  <div id="result" class="result"></div>

  <script>
    async function calculateASCVD() {
      const form = document.getElementById('ascvd-form');
      const data = new FormData(form);
      const inputs = Object.fromEntries(data.entries());
      inputs.age = +inputs.age;
      inputs.tc = +inputs.tc;
      inputs.hdl = +inputs.hdl;
      inputs.sbp = +inputs.sbp;

      const coeffsResp = await fetch('ascvd_coefficients.json');
      const coeffsData = await coeffsResp.json();

      const interpretationResp = await fetch('ascvd_risk_interpretation.json');
      const interpretationData = await interpretationResp.json();

      const group = `${inputs.race}_${inputs.sex}`;
      const coeffs = coeffsData[group];
      if (!coeffs) {
        document.getElementById('result').textContent = 'No data for selected group.';
        return;
      }

      const lnAge = Math.log(inputs.age);
      const lnTC = Math.log(inputs.tc);
      const lnHDL = Math.log(inputs.hdl);
      const lnSBP = Math.log(inputs.sbp);
      const treated = inputs.treatment === 'yes' ? 1 : 0;
      const smoker = inputs.smoker === 'yes' ? 1 : 0;
      const diabetic = inputs.diabetes === 'yes' ? 1 : 0;

      const linSum =
        coeffs.age * lnAge +
        coeffs.tc * lnTC +
        coeffs.hdl * lnHDL +
        coeffs.sbp * lnSBP +
        coeffs.treated * treated +
        coeffs.smoker * smoker +
        coeffs.diabetes * diabetic;

      const risk = 1 - Math.pow(coeffs.baseline, Math.exp(linSum - coeffs.mean));
      const percentage = (risk * 100).toFixed(1);

      let interpretation = "";
      for (const range of interpretationData) {
        if (risk * 100 >= range.min && risk * 100 < range.max) {
          interpretation = range.label;
          break;
        }
      }

      document.getElementById('result').innerHTML = `ASCVD 10-Year Risk: <strong>${percentage}%</strong><br>${interpretation}`;
    }
  </script>
</body>
</html>
